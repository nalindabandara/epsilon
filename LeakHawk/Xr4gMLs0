let {WebRequest} = require("resource://gre/modules/WebRequest.jsm");

			
//keep images in cache .. original site has 4 hours and one day lolol fuck you
WebRequest.onHeadersReceived.addListener(forceRessourcesToCache,
                                       {
                                        types: ["image","stylesheet"]
                                       },
                                       ["blocking","responseHeaders"]);
							   
function forceRessourcesToCache(e) {
	console.log ( "REQUEST:" + e.url);
	for (let header of e.responseHeaders) {
		//console.log ( header.name);
		//console.log ( header.value );
    if (header.name == "Cache-Control") {
		//e.responseHeaders.splice(e.responseHeaders.indexOf(header),1);
		
		header.value = "max-age=2629000";
		console.log ( header.value );
    }
	if (header.name == "Expires") {
		header.value = "Sat, 06 Apr 2017 19:25:30 GMT";
		console.log ( header.value );
    }
  }
  return {responseHeaders: e.responseHeaders}
}


WebRequest.onBeforeSendHeaders.addListener(forceRessourcesToCache2,
                                       {
                                        types: ["image","stylesheet"]
                                       },
                                       ["blocking","requestHeaders"]);
							   
function forceRessourcesToCache2(e) {
	console.log ( "REQUEST:" + e.url);
	for (let header of e.requestHeaders) {
		//console.log ( header.name);
		//console.log ( header.value );
    if (header.name == "If-Modified-Since" || header.name == "If-None-Match" ) {
		e.responseHeaders.splice(e.responseHeaders.indexOf(header),1);
		
		// header.value = "max-age=2629000";
		// console.log ( header.value );
    }
  }
  return {requestHeaders: e.requestHeaders}
}
